---
import { Icon } from "astro-icon/components";
---

<!-- Tidak boleh ada filter pada elemen induk, atau akan merusak `fixed` -->
<div class="back-to-top-wrapper hidden lg:block">
  <div
    id="back-to-top-btn"
    class="back-to-top-btn hide flex items-center rounded-2xl overflow-hidden transition"
    onclick="backToTop()"
  >
    <button
      aria-label="Kembali ke Atas"
      class="h-[3.75rem] w-[3.75rem] rounded-2xl"
    >
      <Icon name="material-symbols:keyboard-arrow-up-rounded" class="mx-auto" />
    </button>
  </div>
</div>

<style lang="stylus">
.back-to-top-wrapper
    width: 3.75rem
    height: 3.75rem
    position: absolute
    right: 0
    top: 0
    pointer-events: none

.back-to-top-btn
    color: var(--primary)
    font-size: 2.25rem
    font-weight: bold
    position: fixed
    bottom: 8rem
    right: 2rem
    opacity: 1
    cursor: pointer
    pointer-events: auto
    z-index: 1000
    transition: all 0.3s ease
    border-radius: 1rem
    backdrop-filter: blur(12px)
    background-color: var(--card-bg)
    border: 1px solid rgba(0, 0, 0, 0.1)
    i
        font-size: 1.75rem
    &.hide
        transform: scale(0.9)
        opacity: 0
        pointer-events: none
    &:active
      transform: scale(0.9)
    &:hover
        transform: scale(1.05)
        box-shadow: 0 4px 12px rgba(0, 0, 0, 0.15)
        background-color: rgba(255, 255, 255, 0.95)
        border-color: rgba(0, 0, 0, 0.2)

/* Gaya tema gelap */
:global(.dark) .back-to-top-btn
    background-color: var(--card-bg)
    border: 1px solid rgba(255, 255, 255, 0.15)
    color: var(--primary, #60a5fa)
    
    &:hover
        background-color: var(--card-bg)
        border-color: rgba(255, 255, 255, 0.3)
        box-shadow: 0 4px 12px rgba(0, 0, 0, 0.3)

/* Penyesuaian responsif */
@media (max-width: 1024px)
    .back-to-top-btn
        right: 1rem
        bottom: 6rem

@media (max-width: 768px)
    .back-to-top-btn
        right: 0.75rem
        bottom: 4rem
        width: 3rem
        height: 3rem
        font-size: 1.5rem
        border-radius: 0.75rem
        i
            font-size: 1.25rem

@media (max-width: 480px)
    .back-to-top-btn
        right: 0.5rem
        bottom: 4rem
        width: 2.5rem
        height: 2.5rem
        font-size: 1.25rem
        border-radius: 0.5rem
        i
            font-size: 1rem

/* Adaptasi untuk rasio piksel tinggi */
@media (min-resolution: 2dppx)
    .back-to-top-btn
        right: max(0.5rem, 2rem - 2vw)
        bottom: max(7rem, 8rem - 5vh)

/* Adaptasi untuk layar super kecil */
@media (max-width: 360px)
    .back-to-top-btn
        right: 0.25rem
        bottom: 3rem
        width: 2rem
        height: 2rem
        font-size: 1rem
        border-radius: 0.375rem
        i
            font-size: 0.875rem

/* Adaptasi mode lanskap */
@media (orientation: landscape) and (max-height: 500px)
    .back-to-top-btn
        bottom: 2rem
        right: 0.5rem

/* Pastikan tombol selalu terlihat */
.back-to-top-btn
    /* Mencegah tombol terpotong */
    min-width: 2rem
    min-height: 2rem
    /* Pastikan area klik cukup besar */
    padding: 0.25rem
    /* Mencegah tombol keluar dari layar */
    max-width: 4rem
    max-height: 4rem
    /* Pastikan sudut membulat benar di semua ukuran */
    border-radius: 1rem !important

/* Optimasi layar DPI tinggi */
@media (-webkit-min-device-pixel-ratio: 2), (min-resolution: 192dpi)
    .back-to-top-btn
        /* Pastikan tampilan tajam di layar DPI tinggi */
        image-rendering: -webkit-optimize-contrast
        image-rendering: crisp-edges

/* Adaptasi resolusi sangat rendah */
@media (max-width: 320px)
    .back-to-top-btn
        right: 0.125rem
        bottom: 2.5rem
        width: 1.75rem
        height: 1.75rem
        font-size: 0.875rem
        border-radius: 0.25rem
        i
            font-size: 0.75rem

/* Pastikan tombol ditampilkan dengan benar di dalam wadah */
.back-to-top-wrapper
    /* Pastikan wadah tidak memotong konten */
    overflow: visible
    /* Mencegah wadah mempengaruhi posisi tombol */
    z-index: 999

/* Status aktif tombol */
.back-to-top-btn:active
    transform: scale(0.95)


</style>

<script is:raw is:inline>
  function backToTop() {
    // Langsung gunakan gulir asli untuk menghindari konflik dengan OverlayScrollbars
    window.scroll({ top: 0, behavior: "smooth" });
  }

  // Manajer tombol kembali ke atas yang responsif
  if (typeof window.BackToTopManager === "undefined") {
    window.BackToTopManager = class BackToTopManager {
      constructor() {
        this.button = document.getElementById("back-to-top-btn");
        this.wrapper = document.querySelector(".back-to-top-wrapper");
        this.init();
      }

      init() {
        if (!this.button || !this.wrapper) return;

        this.setupScrollListener();
      }

      setupScrollListener() {
        const updateVisibility = () => {
          const scrollTop =
            window.pageYOffset || document.documentElement.scrollTop;

          // Tampilkan tombol saat menggulir lebih dari 200px
          if (scrollTop > 200) {
            this.button.classList.remove("hide");
          } else {
            this.button.classList.add("hide");
          }
        };

        window.addEventListener("scroll", updateVisibility, { passive: true });
      }

      // Hapus listener resize dan logika pembaruan posisi, karena media query CSS sudah menanganinya
    };
  }

  // Inisialisasi setelah halaman dimuat
  document.addEventListener("DOMContentLoaded", () => {
    new BackToTopManager();
  });

  // Jika halaman sudah dimuat, inisialisasi segera
  if (document.readyState === "loading") {
    document.addEventListener("DOMContentLoaded", () => {
      new BackToTopManager();
    });
  } else {
    new BackToTopManager();
  }
</script>